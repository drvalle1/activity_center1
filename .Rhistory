source('gibbs functions.R')
#get data
dat=read.csv('fake data.csv',as.is=T)
grid.coord=read.csv('fake data grid.csv',as.is=T)
#basic setup
ngibbs=1000
nburn=ngibbs/2
n.ac=10
gamma1=0.1
#initial coordinates (define this based on data instead of uninformative as below)
ac.coord.init=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
#run gibbs sampler
options(warn=2)
res=gibbs.activity.center(dat=dat,grid.coord=grid.coord,n.ac=n.ac,
ac.coord.init=ac.coord.init,gamma1=gamma1)
set.seed(1)
#basic setup
n.tsegm=100
n.ac=3
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
#cluster membership
z.true=z=sample(1:n.ac,size=n.tsegm,replace=T)
#distance decay parameter
phi.true=phi=0.1
#generate data
y=matrix(NA,n.tsegm,n.grid)
for (i in 1:n.tsegm){
#calculate distance
x2=(grid.coord$x-ac.coord$x[z[i]])^2
y2=(grid.coord$y-ac.coord$y[z[i]])^2
d=sqrt(x2+y2)
#calculate probability
tmp=exp(-phi*d)
prob=tmp/sum(tmp)
#draw results
y[i,]=rmultinom(1,size=n[i],prob=prob)
}
image(y[z==3,])
plot(res$logl,type='l')
plot(res$phi,type='l')
abline(h=phi.true,col='red')
k=data.frame(estim=res$z[ngibbs,],true1=z.true)
table(k)
ordem=c(1,2,3)
n.ac=10
ac.coord=matrix(res$coord[ngibbs,],n.ac,2)
ac.coord[ordem,]
ac.coord.true
plot(unlist(ac.coord.true),ac.coord[ordem,])
rango=range(c(ac.coord.true),ac.coord[ordem,])
plot(unlist(ac.coord.true),ac.coord[ordem,],xlim=rango,ylim=rango)
rango=range(c(ac.coord.true),ac.coord[ordem,])
plot(unlist(ac.coord.true),ac.coord[ordem,],xlim=rango,ylim=rango)
lines(rango,rango,col='red')
rm(list=ls(all=TRUE))
set.seed(1)
#basic setup
n.tsegm=100
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
ac.coord.true
rm(list=ls(all=TRUE))
set.seed(1)
#basic setup
n.tsegm=100
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y)
rm(list=ls(all=TRUE))
set.seed(1)
#basic setup
n.tsegm=100
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y)
#cluster membership
z.true=z=sample(1:n.ac,size=n.tsegm,replace=T)
#distance decay parameter
phi.true=phi=0.1
#generate data
y=matrix(NA,n.tsegm,n.grid)
for (i in 1:n.tsegm){
#calculate distance
x2=(grid.coord$x-ac.coord$x[z[i]])^2
y2=(grid.coord$y-ac.coord$y[z[i]])^2
d=sqrt(x2+y2)
#calculate probability
tmp=exp(-phi*d)
prob=tmp/sum(tmp)
#draw results
y[i,]=rmultinom(1,size=n[i],prob=prob)
}
image(y[z==3,])
setwd('U:\\GIT_models\\activity_center1')
write.csv(y,'fake data.csv',row.names=F)
write.csv(grid.coord,'fake data grid.csv',row.names=F)
rm(list=ls(all=TRUE))
set.seed(10)
#read important functions
setwd('U:\\GIT_models\\activity_center1')
library('Rcpp')
sourceCpp('aux1.cpp')
source('gibbs sampler.R')
source('gibbs functions.R')
#get data
dat=read.csv('fake data.csv',as.is=T)
grid.coord=read.csv('fake data grid.csv',as.is=T)
#basic setup
ngibbs=1000
nburn=ngibbs/2
n.ac=10
gamma1=0.1
#initial coordinates (define this based on data instead of uninformative as below)
ac.coord.init=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
#run gibbs sampler
options(warn=2)
res=gibbs.activity.center(dat=dat,grid.coord=grid.coord,n.ac=n.ac,
ac.coord.init=ac.coord.init,gamma1=gamma1)
rm(list=ls(all=TRUE))
set.seed(1)
#basic setup
n.tsegm=100
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(1)
#basic setup
n.tsegm=200
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(1)
#basic setup
n.tsegm=200
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y,pch=19)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(2)
#basic setup
n.tsegm=200
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y,pch=19)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(3)
#basic setup
n.tsegm=200
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y,pch=19)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(4)
#basic setup
n.tsegm=200
n.ac=5
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y,pch=19)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(4)
#basic setup
n.tsegm=300
n.ac=5
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
plot(ac.coord$x,ac.coord$y,pch=19)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(4)
#basic setup
n.tsegm=300
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(250,500,750),y=c(300,600))
plot(ac.coord$x,ac.coord$y,pch=19)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(4)
#basic setup
n.tsegm=300
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(250,500,750),y=c(300,600))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(4)
#basic setup
n.tsegm=300
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(25,50,75),y=c(30,60))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(5)
#basic setup
n.tsegm=300
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(25,50,75),y=c(30,60))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(5)
#basic setup
n.tsegm=400
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(25,50,75),y=c(30,60))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
rm(list=ls(all=TRUE))
set.seed(5)
#basic setup
n.tsegm=400
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(25,50,75),y=c(30,60))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
#cluster membership
z.true=z=sample(1:n.ac,size=n.tsegm,replace=T)
#distance decay parameter
phi.true=phi=0.1
#generate data
y=matrix(NA,n.tsegm,n.grid)
for (i in 1:n.tsegm){
#calculate distance
x2=(grid.coord$x-ac.coord$x[z[i]])^2
y2=(grid.coord$y-ac.coord$y[z[i]])^2
d=sqrt(x2+y2)
#calculate probability
tmp=exp(-phi*d)
prob=tmp/sum(tmp)
#draw results
y[i,]=rmultinom(1,size=n[i],prob=prob)
}
image(y[z==3,])
setwd('U:\\GIT_models\\activity_center1')
write.csv(y,'fake data.csv',row.names=F)
write.csv(grid.coord,'fake data grid.csv',row.names=F)
rm(list=ls(all=TRUE))
set.seed(5)
#basic setup
n.tsegm=400
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(25,50,75),y=c(30,60))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
ac.coord
rm(list=ls(all=TRUE))
set.seed(5)
#basic setup
n.tsegm=400
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(25,50,75),y=c(30,60))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
#cluster membership
z.true=z=sample(1:n.ac,size=n.tsegm,replace=T)
#distance decay parameter
phi.true=phi=0.1
#generate data
y=matrix(NA,n.tsegm,n.grid)
for (i in 1:n.tsegm){
#calculate distance
x2=(grid.coord$x-ac.coord$x[z[i]])^2
y2=(grid.coord$y-ac.coord$y[z[i]])^2
d=sqrt(x2+y2)
#calculate probability
tmp=exp(-phi*d)
prob=tmp/sum(tmp)
#draw results
y[i,]=rmultinom(1,size=n[i],prob=prob)
}
image(y[z==5,])
rm(list=ls(all=TRUE))
set.seed(5)
#basic setup
n.tsegm=400
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(25,50,75),y=c(30,60))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
#cluster membership
z.true=z=sample(1:n.ac,size=n.tsegm,replace=T)
#distance decay parameter
phi.true=phi=0.1
#generate data
y=matrix(NA,n.tsegm,n.grid)
for (i in 1:n.tsegm){
#calculate distance
x2=(grid.coord$x-ac.coord$x[z[i]])^2
y2=(grid.coord$y-ac.coord$y[z[i]])^2
d=sqrt(x2+y2)
#calculate probability
tmp=exp(-phi*d)
prob=tmp/sum(tmp)
#draw results
y[i,]=rmultinom(1,size=n[i],prob=prob)
}
image(y[z==5,])
setwd('U:\\GIT_models\\activity_center1')
write.csv(y,'fake data.csv',row.names=F)
write.csv(grid.coord,'fake data grid.csv',row.names=F)
rm(list=ls(all=TRUE))
set.seed(10)
#read important functions
setwd('U:\\GIT_models\\activity_center1')
library('Rcpp')
sourceCpp('aux1.cpp')
source('gibbs sampler.R')
source('gibbs functions.R')
#get data
dat=read.csv('fake data.csv',as.is=T)
grid.coord=read.csv('fake data grid.csv',as.is=T)
#basic setup
ngibbs=1000
nburn=ngibbs/2
n.ac=10
gamma1=0.1
#initial coordinates (define this based on data instead of uninformative as below)
ac.coord.init=data.frame(x=runif(n.ac,min=0,max=100),
y=runif(n.ac,min=0,max=100))
#run gibbs sampler
options(warn=2)
res=gibbs.activity.center(dat=dat,grid.coord=grid.coord,n.ac=n.ac,
ac.coord.init=ac.coord.init,gamma1=gamma1)
plot(res$logl,type='l')
plot(res$phi,type='l')
abline(h=phi.true,col='red')
set.seed(5)
#basic setup
n.tsegm=400
n.ac=6
n.grid=30
n=floor(runif(n.tsegm,min=0,max=900))
#spatial coordinates
grid.coord=data.frame(x=runif(n.grid,min=0,max=100),
y=runif(n.grid,min=0,max=100))
ac.coord.true=ac.coord=expand.grid(x=c(25,50,75),y=c(30,60))
rangox=range(c(ac.coord$x,grid.coord$x))
rangoy=range(c(ac.coord$y,grid.coord$y))
plot(ac.coord$x,ac.coord$y,pch=19,xlim=rangox,ylim=rangoy)
points(grid.coord$x,grid.coord$y,col='red')
#cluster membership
z.true=z=sample(1:n.ac,size=n.tsegm,replace=T)
#distance decay parameter
phi.true=phi=0.1
#generate data
y=matrix(NA,n.tsegm,n.grid)
for (i in 1:n.tsegm){
#calculate distance
x2=(grid.coord$x-ac.coord$x[z[i]])^2
y2=(grid.coord$y-ac.coord$y[z[i]])^2
d=sqrt(x2+y2)
#calculate probability
tmp=exp(-phi*d)
prob=tmp/sum(tmp)
#draw results
y[i,]=rmultinom(1,size=n[i],prob=prob)
}
image(y[z==5,])
plot(res$phi,type='l')
abline(h=phi.true,col='red')
k=data.frame(estim=res$z[ngibbs,],true1=z.true)
table(k)
ordem=c(6,2,4,3,5,1)
table(k)[ordem,]
n.ac=10
ac.coord=matrix(res$coord[ngibbs,],n.ac,2)
ac.coord[ordem,]
ac.coord.true
rango=range(c(ac.coord.true),ac.coord[ordem,])
plot(unlist(ac.coord.true),ac.coord[ordem,],xlim=rango,ylim=rango)
lines(rango,rango,col='red')
plot(ac.coord[1:5,1],ac.coord[1:5,2])
plot(ac.coord[1:6,1],ac.coord[1:6,2])
rango=range(c(ac.coord.true),ac.coord[ordem,])
plot(unlist(ac.coord.true),ac.coord[ordem,],xlim=rango,ylim=rango)
lines(rango,rango,col='red')
